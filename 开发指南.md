# 开发指南

## 项目结构

```
uml-render/
├── manifest.json          # 扩展配置
├── background.js          # 后台服务
├── content.js             # 核心渲染逻辑
├── content.css            # 样式
├── plantuml-encoder.js    # PlantUML 编码
├── pako.min.js            # Deflate 压缩库
├── popup.html/popup.js    # 设置界面
├── icons/                 # 扩展图标
└── generate-icons.js      # 图标生成脚本
```

## 技术栈

- Chrome Extension Manifest V3
- PlantUML Server API
- Deflate + Base64 编码
- MutationObserver（DOM 监听）
- Debounce（性能优化）

## 修改代码

1. 编辑代码文件
2. 打开 `chrome://extensions/`
3. 点击扩展的刷新按钮
4. 重新加载测试页面

## 调试方法

开启扩展的"调试模式"，查看控制台日志：

```
[UMLRender] 扫描到 N 个代码块
[UMLRender] 识别 PlantUML #0
[PlantUML Encoder] 原始代码: ...
```

## 核心逻辑

### 代码块识别

通过 CSS 选择器扫描页面：
- 金山文档：`pre.code-block-wrapper`
- GitHub：`.highlight pre`、`pre > code`
- 通用：`pre[class*="code-block"]`

### 渲染流程

1. 扫描代码块 → 2. 识别 PlantUML → 3. 编码 → 4. 请求服务器 → 5. 渲染图片 → 6. 缓存

### 平台兼容

不同平台 DOM 结构差异大，新增平台支持需：
1. 分析目标平台的代码块 DOM 结构
2. 添加对应的 CSS 选择器
3. 测试代码提取逻辑
4. 更新文档

## 图标生成

```bash
node generate-icons.js
```

生成 16px、48px、128px 三个尺寸的图标。
